# Hadoop生态

---

## Hadoop

* **是什么** ：一个大数据处理的框架/生态系统，不是单一软件。
* **作用** ：提供大数据的存储、计算、管理能力。
* **核心模块** ：

1. **HDFS** → 分布式存储
2. **YARN** → 资源调度/作业管理
3. **MapReduce** → 分布式计算框架
4. **（外加 HBase、Hive、Spark 等扩展组件）**

可以理解为： **Hadoop = 一整套分布式大数据操作系统** 。

---

## HDFS (Hadoop Distributed File System)

* **是什么** ：Hadoop 的分布式文件系统。
* **作用** ：把很多台机器的磁盘组合在一起，当作一个“超级大硬盘”来存放数据。
* **特点** ：
* 文件会被切分成数据块（通常 128MB 一块），分散存储在不同机器上。
* 有副本机制（默认 3 份），保证数据不丢失。
* **比喻** ：像把一个大文件柜切分成很多抽屉，放到不同的房间，钥匙（NameNode）知道每个抽屉在哪。

**HDFS中有NameNode和DataNode:**

**NameNode**

* **是什么**：HDFS 的“大脑”，文件系统的管理者。
* **作用**：

    * 负责存储文件的元数据（比如 `/user/data/file1.txt` 存在哪些 DataNode、文件大小、权限等信息）。
    * 不存储文件内容，只存储目录树和块映射信息。
    * 客户端要访问 HDFS 的文件时，先找 NameNode。
* **举例**：你往 HDFS 上传一个 128MB 的文件 → NameNode 记录：这个文件被切成 2 个块，分别存储在哪些 DataNode 上。

**DataNode**

* **是什么**：HDFS 的“工人”，存储实际的数据块。
* **作用**：

    * 存储文件块（block），定期向 NameNode 汇报健康状态和存储块信息。
    * 负责读写数据（客户端直接和 DataNode 交互，而不是 NameNode）。
* **举例**：当你写文件到 HDFS 时，数据最终是写到 DataNode 磁盘上。

## MapReduce

* **是什么** ：Hadoop 提供的  **分布式计算模型** 。
* **作用** ：用来在集群里并行处理大规模数据。
* **运行流程** ：

1. **Map** ：把任务分成小块，分发给多个节点（例如：每个节点统计自己那部分单词词频）。
2. **Reduce** ：把各个节点的结果汇总（例如：合并所有节点的词频，得到全局统计）。

* **比喻** ：像老师布置作业，把试卷分给很多学生（Map），最后收回来汇总成绩（Reduce）。

---

## YARN (Yet Another Resource Negotiator)

* **是什么** ：Hadoop 的  **资源管理与作业调度框架** 。
* **作用** ：决定  **哪个任务在哪台机器上跑** ，以及如何分配 CPU/内存等资源。
* **核心角色** ：
* **ResourceManager**

    * **是什么**：**整个集群**的“资源总管”。
    * **作用**：

        * 管理集群的计算资源（CPU、内存等）。
        * 调度任务：比如你提交一个 MapReduce 作业，ResourceManager 会决定在哪些节点启动对应的任务。
* **NodeManager**

    * **是什么**：每个**工作节点**上的“资源代理”。
    * **作用**：

        * 向 ResourceManager 汇报本机的资源情况（多少内存、多少 CPU 可用）。
        * 负责启动和监控在本节点上运行的任务（容器）。
    * **关系**：NodeManager 就像一个“分公司经理”，听 ResourceManager 的调度安排。

---

## HBase

* **是什么** ：基于 HDFS 构建的  **分布式 NoSQL 数据库** 。
* **作用** ：用来存储  **大规模结构化数据** ，支持快速的随机读写（不像 HDFS 只能顺序读写）。
* **特点** ：
* 数据模型是  **表 → 行键(RowKey) → 列族 → 列 → 值** 。
* 可以存储数十亿行、数百万列的大表。
* **比喻** ：HDFS 像一个“大仓库”（文件系统），但仓库只能顺序翻找；HBase 在仓库上面加了一层“索引系统”，让你可以像查字典一样快速定位某一行某一列。

---

## ZooKeeper

在 Hadoop 生态里， **HDFS + YARN 本身就能跑起来** ，但一旦引入  **HBase** ，就必须有 **ZooKeeper** 才能正常工作。

---

* ZooKeeper 是一个  **分布式协调服务** 。
* 它自己并不是数据库、存储或计算引擎，而是一个  **管理集群的“调度员/管理员”** 。
* 可以用来：

    1. 管理  **分布式应用的配置** （例如谁是主节点）。
    2. 提供  **命名服务** （给节点/服务取名字）。
    3. 提供  **分布式锁** （保证多个客户端操作的顺序和互斥）。
    4. 监控节点状态（心跳检测，宕机感知）。

---

### 为什么 HBase 需要 ZooKeeper？

HBase 是一个  **分布式数据库** ，它有：

* **HMaster** （负责管理表的元数据、分配 RegionServer）。
* **HRegionServer** （真正存储数据，处理读写请求）。

问题来了：

* 如果有多个 HMaster，谁来决定  **哪个是“主 HMaster”** ？
* 如果某个 RegionServer 挂掉了，谁来通知 HMaster ？
* 客户端如何快速找到自己要访问的 RegionServer？

这些协调、选主、状态检测的事情，就交给了  **ZooKeeper** 。

---

在配置的伪分布式环境时

* 单独启动了 ZooKeeper（`zkServer.sh start`）。
* HBase 配置里写了：

  ```xml
  <property>
      <name>hbase.zookeeper.quorum</name>
      <value>localhost</value>
  </property>
  <property>
      <name>hbase.zookeeper.property.clientPort</name>
      <value>2181</value>
  </property>
  ```

  意味着：

    * **HBase Master、RegionServer、客户端** 都会去找 `localhost:2181` 这个 ZooKeeper，来完成“谁是主 HMaster、RegionServer 状态、客户端路由”等协调功能。

---

## 关系总结（一句话版）

* **Hadoop** = 整个生态系统
* **HDFS** = 存储层（存大文件）
* **MapReduce** = 计算层（怎么处理数据）
* **YARN** = 资源调度层（让任务跑起来）
* **HBase** = 数据库（在 HDFS 上建表，快速查改数据）

---

# 分布方式比较

---

## 单机模式（Standalone Mode）

* **特点** ：
* 默认安装 Hadoop 后就是单机模式。
* 所有进程都运行在一个 JVM 里，没有 HDFS，没有 YARN。
* 数据存在本地文件系统（ext4/xfs 等）。
* **用途** ：
* 测试最基本的功能（例如写个 MapReduce 逻辑跑一下）。
* 不涉及真正的分布式存储或计算。

## 伪分布式（Pseudo-distributed Mode）

* **特点** ：
* 所有 Hadoop 组件（NameNode、DataNode、ResourceManager、NodeManager 等）都跑在 **一台机器** 上。
* 进程之间还是通过网络（localhost）通信，模拟集群环境。
* 数据存储在本机磁盘上，但逻辑上仍然使用 HDFS 的块、副本机制。
* **用途** ：
* 学习/开发阶段常用，可以在本地模拟完整的 Hadoop 运行环境。
* 方便理解  **进程之间的关系** ，练习 HDFS + YARN + HBase 的启动与使用。

---

## 完全分布式（Fully-distributed Mode）

* **特点** ：
* Hadoop 部署在 **多台机器** 上（通常是几十到上千台）。
* NameNode 负责全局元数据，DataNode 分布在各台机器上。
* 任务由 ResourceManager 调度到不同机器上的 NodeManager 执行。
* 具备真正的分布式存储和并行计算能力。
* **用途** ：
* 生产环境下使用，存储 TB/PB 级数据，支撑海量计算任务。

---

## 总结对比表

| 模式       | 部署规模 | 进程分布 | 存储方式           | 使用场景             |
| ---------- | -------- | -------- | ------------------ | -------------------- |
| 单机模式   | 1 台机器 | 单进程   | 本地文件系统       | 最简单的功能测试     |
| 伪分布式   | 1 台机器 | 多进程   | HDFS（存本地盘）   | 学习、实验、开发     |
| 完全分布式 | 多台机器 | 多进程   | HDFS（跨机器存储） | 生产环境、大数据处理 |

---