# 启动环境

（在 master 上操作，依赖 SSH 能免密登录）

先格式化 NameNode（只做一次，master 上）：

```bash
hdfs namenode -format
```

启动 ZooKeeper 集群（在每台或通过 ssh 远程）：

```bash
# 从 master 开启所有 zk
ssh user@master  "zkServer.sh start"
ssh user@worker1 "zkServer.sh start"
ssh user@worker2 "zkServer.sh start"

# 验证
ssh user@master  "zkServer.sh status"
ssh user@worker1 "zkServer.sh status"
ssh user@worker2 "zkServer.sh status"
```

启动 HDFS + YARN（从 master）：

```bash
# 这会通过 ssh 到 workers 启动 DataNode/NodeManager
start-dfs.sh
start-yarn.sh
```

检查每台机器 `jps`，应看到：

* master: NameNode, ResourceManager, SecondaryNameNode(if any), HMaster, QuorumPeerMain
* worker1/worker2: DataNode, NodeManager, HRegionServer, QuorumPeerMain

![image-20250912150331865](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131953093.png)

![image-20250912150414350](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131947455.png)

![image-20250912150355694](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131953093.png)

HDFS NameNode UI: `http://master:9870`![image-20250912150445172](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131947206.png)



四台机器：
![image-20250912201345126](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131947190.png)

YARN UI: `http://master:8088`

![image-20250912151058398](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131947139.png)

启动 HBase（master）：

```bash
start-hbase.sh
```



验证 HBase Master UI： `http://master:16010`![image-20250912151002258](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131947556.png)



四机器完全分布集群

![image-20250912151025653](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131947184.png)





# 分割文件

```python
import os
import math
import logging
# 用于处理老师发的文件
# 这个脚本用于将一个大的txt文件按每10000行分割成多个小文件
# 指定输入文件和输出目录
input_file_path = r"./data/sentences/sentences.txt"  # 输入的txt文件路径
output_directory = r'./data/sentences/files'  # 指定的输出目录路径
logging.basicConfig(level=logging.INFO)
logging.info('Starting file splitting')
# 打开原始txt文件,一共有9397023条句子
with open(input_file_path, 'r', encoding='utf-8') as input_file:
    lines = input_file.readlines()
# 计算总行数和文件数
total_lines = len(lines)
num_files = (total_lines + 9999) // 10000
# 分割文件
for i in range(num_files):
    logging.info(f'Processing file {i + 1}/{num_files}')
    start = i * 10000
    end = min((i + 1) * 10000, total_lines)
    output_filename = os.path.join(output_directory, f'file{i}.txt')

    # 写入分割后的内容到新文件
    with open(output_filename, 'w', encoding='utf-8') as output_file:
        output_file.writelines(lines[start:end])
```

![image-20250912160346685](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131947463.png)

# 上传文件

把分割好的文件存入hdfs

![image-20250913192321852](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131948339.png)

存完可以看到存入的文件大小：
![image-20250913192407901](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131948218.png)







# 运行结果

### 四机器完全分布

运行用时34分钟

![image-20250913192452973](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131948695.png)



## 单机伪分布

  ……





























# 数据库查看

## 查看数据库

![image-20250913192815106](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131948368.png)

![image-20250912201225483](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131948367.png)

```bash
hbase:004:0> scan 'InvertedIndexTable', {LIMIT => 20}
ROW                                      COLUMN+CELL                                                                                                         
 0                                       column=info:index, timestamp=2025-09-12T20:01:50.044, value=file10.txt:20;                                          
 00                                      column=info:index, timestamp=2025-09-12T20:01:50.044, value=file115.txt:8;                                          
 000                                     column=info:index, timestamp=2025-09-12T20:01:50.044, value=file112.txt:73;                                         
 0000                                    column=info:index, timestamp=2025-09-12T20:01:50.044, value=file103.txt:1;                                          
 00003591                                column=info:index, timestamp=2025-09-12T20:01:50.044, value=file113.txt:1;                                          
 0001                                    column=info:index, timestamp=2025-09-12T20:01:50.044, value=file101.txt:1;                                          
 0002                                    column=info:index, timestamp=2025-09-12T20:01:50.044, value=file112.txt:1;                                          
 000ft                                   column=info:index, timestamp=2025-09-12T20:01:50.044, value=file111.txt:1;                                          
 000kilowatt                             column=info:index, timestamp=2025-09-12T20:01:50.044, value=file111.txt:1;                                          
 000kw                                   column=info:index, timestamp=2025-09-12T20:01:50.044, value=file100.txt:1;                                          
 000lb                                   column=info:index, timestamp=2025-09-12T20:01:50.044, value=file110.txt:1;                                          
 000mw                                   column=info:index, timestamp=2025-09-12T20:01:50.044, value=file115.txt:1;                                          
 000s                                    column=info:index, timestamp=2025-09-12T20:01:50.044, value=file105.txt:1;                                          
 000sqm                                  column=info:index, timestamp=2025-09-12T20:01:50.044, value=file112.txt:1;                                          
 000th                                   column=info:index, timestamp=2025-09-12T20:01:50.044, value=file11.txt:1;file115.txt:1;                             
 001                                     column=info:index, timestamp=2025-09-12T20:01:50.044, value=file109.txt:1;file108.txt:1;                            
 002                                     column=info:index, timestamp=2025-09-12T20:01:50.044, value=file110.txt:3;                                          
 002nd                                   column=info:index, timestamp=2025-09-12T20:01:50.044, value=file111.txt:1;                                          
 004                                     column=info:index, timestamp=2025-09-12T20:01:50.044, value=file101.txt:1;                                          
 005                                     column=info:index, timestamp=2025-09-12T20:01:50.044, value=file103.txt:1;                                          
20 row(s)
Took 0.4353 seconds   
```



## 调用查询工具

使用用于查询数据库的jar包来查询结果

![image-20250913192912421](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131948365.png)

## 使用web ui

使用web ui可视化查询

![image-20250913193030509](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131948675.png)

![image-20250913193011958](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131948630.png)

![image-20250913193018256](https://raw.githubusercontent.com/SunJianBai/pictures/main/img/202509131948320.png)







